package controller

import (
	"encoding/xml"
	"sync"
	"time"
	"fmt"
	"strconv"
)

const (
	// sn(%s),
	// workorder_id(%d),
	// result_id(%d),
	// 拧紧次数(%d),
	// 拧接结果(IO, NIO)(%s),
	// 日期(%s)，
	// 时间(%s)
	// 实际扭矩(%f)
	// 实际角度(%f)
	// 实际时间(%f)
	// 扭矩波形
	// 角度波形

	xml_result = "<?xml version=\"1.0\" encoding=\"UTF-8\"?> <root:ROOT xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:root=\"http://pdps.in.audi.vwg/legacy_schema/20.7.2/root\" xsi:schemaLocation=\"http://pdps.in.audi.vwg/legacy_schema/20.7.2/root root.xsd\"> <PRC_SST> <PNR>21</PNR> <PAR> <PRT>%s</PRT> <PI1>%d</PI1> <PI2>%d</PI2> <STC>%d</STC> <PSC>%s</PSC> <FAS> <FAP>FAP</FAP> <FNR>FNR</FNR> <COM>COM</COM> <CNR>CNR</CNR> <WID>WID</WID> <FSC>IO</FSC> <SIO>1</SIO> <IIO>1</IIO> <INO>0</INO> <GRP> <PNR>21</PNR> <VEN>DES</VEN> <TYP>CVI3</TYP> <SNR>27091400470</SNR> <VNR>1.6.3.8</VNR> <TCI>EC-Schrauber</TCI> <IPA>192.168.1.202</IPA> <SBZ> </SBZ> <CIO>5</CIO> <CNO>5</CNO> <GNR>0</GNR> <TIP> <TAP>TAP</TAP> <TNR>TNR</TNR> <NUT>0</NUT> <PRG>1</PRG> <SID>15G01114</SID> <STY>EAD32-900</STY> <CAL>31.941</CAL> <TID>2382</TID> <CSR>2382</CSR> <CSA>0</CSA> <DAT>%s</DAT> <TIM>%s</TIM> <TSC>0</TSC> <TAC>Schraubverbindung i.O. (keine Nacharbeit)</TAC> <KNR>1</KNR> <STA>IO</STA> <BLC> <BAP> </BAP> <BNR>1</BNR> <SSC>0</SSC> <NAC>Schraubverbindung i.O. (keine Nacharbeit)</NAC> <PRO> <PAP>AW</PAP> <MAR> <NAM>M+</NAM> <UNT>Nm</UNT> <VAL>1</VAL> </MAR> <MAR> <NAM>M-</NAM> <UNT>Nm</UNT> <VAL>0</VAL> </MAR> <MAR> <NAM>W+</NAM> <UNT>Grad</UNT> <VAL>190</VAL> </MAR> <MAR> <NAM>W-</NAM> <UNT>Grad</UNT> <VAL>170</VAL> </MAR> <MAR> <NAM>t+</NAM> <UNT>s</UNT> <VAL>5</VAL> </MAR> <MAR> <NAM>t-</NAM> <UNT>s</UNT> <VAL>0</VAL> </MAR> <MAR> <NAM>n</NAM> <UNT>min-1</UNT> <VAL>13</VAL> </MAR> <MAR> <NAM>MI</NAM> <UNT>Nm</UNT> <VAL>%f</VAL> </MAR> <MAR> <NAM>WI</NAM> <UNT>Grad</UNT> <VAL>%f</VAL> </MAR> <MAR> <NAM>tI</NAM> <UNT>s</UNT> <VAL>%f</VAL> </MAR> <MAR> <NAM>MS</NAM> <UNT>Nm</UNT> <VAL>0.025</VAL> </MAR> <MAR> <NAM>WA</NAM> <UNT>Grad</UNT> <VAL>180</VAL> </MAR> <MAR> <NAM>MO</NAM> <UNT>Nm</UNT> <VAL>1</VAL> </MAR> <MAR> <NAM>MU</NAM> <UNT>Nm</UNT> <VAL>0.025</VAL> </MAR> </PRO> <CUR> <GCU>1</GCU> <XAP>tI</XAP> <XUN>s</XUN> <STP>0.0005</STP> <STV>0</STV> <YA1>MI</YA1> <YU1>Nm</YU1> <YA2>WI</YA2> <YU2>Grad</YU2> <CNT>1999</CNT> <SMP> <Y1V>0 0.024 0.02 0.016 0.012 0.016 0.024 0.024 0.028 0.028 0.024 0.024 0.024 0.024 0.024 0.024 0.024 0.028 0.028 0.02 0.02 0.024 0.028 0.032 0.032 0.028 0.028 0.028 0.032 0.035 0.032 0.028 0.032 0.032 0.032 0.032 0.028 0.024 0.024 0.032 0.032 0.035 0.035 0.032 0.028 0.032 0.039 0.043 0.039 0.035 0.035 0.035 0.035 0.035 0.035 0.035 0.035 0.032 0.028 0.024 0.032 0.035 0.035 0.043 0.047 0.047 0.043 0.039 0.047 0.051 0.047 0.047 0.043 0.008 0.043 0.134 0.296 0.232 0.122 0.063 0.059 0.091 0.067 0.059 0.091 0.095 0.039 0.012 0.016 0 0.035 0.051 0.083 0.114 0.106 0.079 0.075 0.071 0.047 0.02 0.035 0.039 0.032 0.055 0.059 0.039 0.055 0.099 0.122 0.106 0.051 0.024 0.035 0.039 0.016 0.024 0.039 0.047 0.012 0.028 0.035 0.035 0.035 0.067 0.11 0.142 0.126 0.071 0.039 0.043 0.047 0.024 0.024 0.047 0.055 0.008 0.028 0.028 0.012 0.032 0.047 0.087 0.114 0.087 0.039 0.032 0.043 0.035 0.004 0.039 0.055 0.047 0 0.028 0.024 0.028 0.043 0.079 0.114 0.102 0.051 0.028 0.039 0.043 0.012 0.032 0.043 0.047 0.008 0.032 0.039 0.028 0.032 0.059 0.099 0.126 0.102 0.047 0.032 0.051 0.047 0.008 0.043 0.063 0.063 0.008 0.032 0.028 0.004 0.028 0.047 0.095 0.11 0.071 0.024 0.028 0.035 0.028 0.035 0.051 0.063 0.02 0.024 0.024 0.012 0.024 0.039 0.083 0.122 0.102 0.043 0.024 0.039 0.039 0.008 0.035 0.051 0.051 0.004 0.032 0.032 0.028 0.035 0.059 0.095 0.122 0.102 0.047 0.024 0.039 0.032 0 0.039 0.055 0.047 0.028 0.035 0.02 0.032 0.051 0.091 0.114 0.095 0.035 0.024 0.032 0.035 0.008 0.028 0.039 0.032 0.032 0.035 0.024 0.024 0.035 0.071 0.114 0.118 0.067 0.024 0.035 0.047 0.024 0.028 0.043 0.035 0.035 0.047 0.032 0.024 0.059 0.102 0.126 0.11 0.067 0.039 0.043 0.039 0.016 0.028 0.047 0.059 0.012 0.032 0.035 0.024 0.028 0.039 0.087 0.122 0.091 0.039 0.032 0.051 0.039 0.028 0.043 0.055 0.024 0.024 0.035 0.024 0.024 0.035 0.079 0.118 0.114 0.063 0.02 0.028 0.039 0.039 0 0.039 0.051 0.043 0.028 0.035 0.02 0.035 0.051 0.095 0.122 0.102 0.055 0.035 0.047 0.043 0.012 0.035 0.055 0.059 0.024 0.035 0.028 0.024 0.039 0.087 0.118 0.106 0.051 0.024 0.032 0.035 0.008 0.032 0.047 0.055 0.016 0.024 0.032 0.02 0.024 0.039 0.083 0.114 0.095 0.039 0.024 0.043 0.039 0.012 0.028 0.047 0.047 0.024 0.035 0.035 0.024 0.039 0.083 0.122 0.122 0.071 0.028 0.032 0.039 0.02 0.024 0.047 0.067 0.035 0.024 0.024 0.008 0.039 0.059 0.099 0.118 0.083 0.032 0.024 0.039 0.028 0.032 0.051 0.055 0.008 0.024 0.02 0 0.039 0.067 0.114 0.114 0.071 0.032 0.032 0.039 0.016 0.035 0.051 0.051 0.035 0.051 0.039 0.024 0.039 0.087 0.126 0.122 0.067 0.032 0.043 0.043 0.016 0.028 0.047 0.063 0.028 0.024 0.032 0.02 0.024 0.039 0.079 0.114 0.099 0.043 0.024 0.032 0.032 0.004 0.035 0.051 0.043 0.024 0.032 0.024 0.032 0.063 0.102 0.122 0.091 0.039 0.028 0.043 0.028 0.028 0.039 0.047 0.008 0.039 0.043 0.028 0.032 0.051 0.091 0.122 0.106 0.051 0.032 0.051 0.047 0.02 0.028 0.051 0.067 0.024 0.028 0.032 0.016 0.024 0.043 0.095 0.118 0.091 0.039 0.024 0.032 0.032 0.024 0.043 0.059 0.024 0.028 0.035 0.02 0.035 0.055 0.095 0.114 0.079 0.032 0.028 0.043 0.039 0.008 0.032 0.047 0.039 0.028 0.035 0.032 0.035 0.063 0.102 0.134 0.114 0.055 0.028 0.039 0.035 0.012 0.028 0.047 0.051 0.008 0.024 0.024 0.012 0.024 0.039 0.079 0.106 0.099 0.051 0.024 0.032 0.035 0.012 0.024 0.039 0.051 0.008 0.039 0.043 0.028 0.024 0.035 0.079 0.114 0.102 0.047 0.028 0.032 0.028 0 0.035 0.051 0.051 0.024 0.039 0.039 0.028 0.035 0.075 0.114 0.122 0.079 0.043 0.043 0.047 0.028 0.039 0.055 0.051 0.012 0.016 0.016 0.012 0.032 0.047 0.087 0.106 0.075 0.032 0.032 0.043 0.024 0.032 0.051 0.051 0.004 0.032 0.032 0.016 0.032 0.051 0.095 0.122 0.095 0.035 0.024 0.039 0.032 0 0.035 0.051 0.047 0.028 0.043 0.039 0.035 0.059 0.095 0.126 0.114 0.063 0.032 0.043 0.043 0.02 0.039 0.055 0.047 0 0.024 0.02 0.016 0.032 0.047 0.087 0.114 0.095 0.039 0.028 0.043 0.032 0.024 0.039 0.055 0.024 0.032 0.028 0.016 0.035 0.055 0.099 0.118 0.083 0.028 0.028 0.035 0.032 0.028 0.043 0.059 0.024 0.028 0.039 0.032 0.028 0.047 0.083 0.114 0.106 0.055 0.024 0.028 0.032 0.028 0.028 0.047 0.059 0.02 0.024 0.024 0.012 0.028 0.047 0.091 0.114 0.091 0.039 0.024 0.032 0.028 0 0.032 0.047 0.039 0.024 0.028 0.016 0.035 0.059 0.102 0.118 0.079 0.035 0.032 0.047 0.028 0.028 0.039 0.051 0.012 0.039 0.043 0.032 0.032 0.059 0.099 0.126 0.102 0.047 0.028 0.047 0.043 0.004 0.043 0.063 0.063 0.012 0.032 0.032 0.016 0.024 0.035 0.079 0.118 0.11 0.051 0.012 0.024 0.032 0.028 0.024 0.043 0.059 0.02 0.024 0.032 0.024 0.028 0.055 0.099 0.118 0.075 0.028 0.032 0.043 0.032 0.024 0.043 0.051 0.008 0.032 0.035 0.024 0.032 0.059 0.095 0.114 0.095 0.043 0.028 0.043 0.035 0 0.043 0.059 0.055 0.004 0.032 0.032 0.016 0.035 0.051 0.095 0.106 0.067 0.024 0.028 0.035 0.02 0.032 0.051 0.059 0.012 0.028 0.028 0.012 0.024 0.043 0.095 0.13 0.11 0.051 0.028 0.043 0.039 0.004 0.032 0.047 0.043 0 0.032 0.032 0.02 0.024 0.035 0.079 0.122 0.126 0.079 0.043 0.043 0.039 0.016 0.039 0.051 0.043 0.024 0.035 0.024 0.028 0.043 0.083 0.11 0.099 0.047 0.028 0.035 0.032 0.004 0.032 0.047 0.039 0.032 0.035 0.02 0.012 0.035 0.055 0.102 0.114 0.067 0.028 0.032 0.043 0.028 0.035 0.051 0.032 0.035 0.035 0.024 0.024 0.032 0.059 0.102 0.122 0.083 0.032 0.032 0.043 0.028 0.004 0.035 0.047 0.032 0.032 0.032 0.016 0.032 0.051 0.095 0.114 0.087 0.039 0.024 0.032 0.028 0.004 0.039 0.051 0.032 0.035 0.032 0.012 0.039 0.055 0.095 0.11 0.075 0.028 0.024 0.039 0.028 0.028 0.043 0.051 0.008 0.039 0.043 0.028 0.028 0.047 0.095 0.122 0.102 0.059 0.035 0.043 0.043 0.012 0.028 0.047 0.051 0.004 0.028 0.024 0.016 0.032 0.047 0.079 0.11 0.102 0.055 0.028 0.039 0.047 0.016 0.028 0.043 0.055 0.012 0.035 0.039 0.02 0.024 0.039 0.087 0.122 0.075 0.043 0.02 0.02 0.043</Y1V> <Y2V>0 8.54 8.54 8.54 8.54 8.54 8.54 8.54 8.55 8.55 8.55 8.56 8.56 8.57 8.57 8.58 8.58 8.59 8.59 8.61 8.62 8.62 8.63 8.64 8.65 8.66 8.67 8.68 8.69 8.7 8.72 8.73 8.74 8.76 8.77 8.79 8.81 8.83 8.85 8.87 8.89 8.92 8.94 8.97 9 9.02 9.05 9.08 9.1 9.13 9.16 9.19 9.22 9.24 9.27 9.3 9.33 9.35 9.37 9.4 9.42 9.45 9.48 9.51 9.53 9.57 9.6 9.64 9.68 9.72 9.74 9.79 9.91 10.17 10.54 10.74 11.14 11.53 11.91 12.26 12.56 12.84 13.1 13.46 13.58 13.81 14.04 14.27 14.5 14.74 14.99 15.12 15.38 15.64 15.9 16.16 16.43 16.71 16.99 17.27 17.68 17.82 18.25 18.39 18.66 18.93 19.21 19.48 19.75 20.02 20.28 20.55 20.8 21.06 21.33 21.59 21.72 21.99 22.25 22.51 22.65 22.92 23.19 23.46 23.73 24 24.27 24.54 24.82 25.08 25.34 25.62 25.88 26.02 26.29 26.56 26.84 26.97 27.23 27.64 27.77 28.05 28.3 28.57 28.83 29.1 29.37 29.63 29.9 30.16 30.3 30.57 30.86 31.13 31.27 31.66 31.8 32.07 32.35 32.62 32.88 33.14 33.41 33.67 33.93 34.2 34.34 34.6 34.86 35.13 35.27 35.55 35.82 36.09 36.36 36.63 36.9 37.18 37.45 37.72 37.98 38.25 38.52 38.65 38.92 39.19 39.45 39.58 39.85 40.26 40.39 40.66 40.93 41.19 41.46 41.86 42 42.27 42.67 42.8 43.08 43.35 43.63 43.76 44.03 44.3 44.43 44.71 44.98 45.25 45.5 45.77 46.03 46.3 46.56 46.83 46.96 47.23 47.49 47.77 47.9 48.18 48.45 48.72 48.99 49.25 49.53 49.8 50.07 50.33 50.6 50.87 51.14 51.27 51.54 51.94 52.08 52.34 52.75 52.89 53.16 53.42 53.69 53.95 54.36 54.49 54.76 55.03 55.3 55.43 55.71 56.12 56.26 56.52 56.79 56.93 57.2 57.48 57.75 58.01 58.28 58.54 58.81 59.08 59.47 59.61 59.87 60.27 60.4 60.68 60.95 61.22 61.49 61.76 62.03 62.3 62.58 62.84 63.1 63.36 63.64 63.77 64.04 64.31 64.58 64.71 64.98 65.39 65.52 65.79 66.05 66.32 66.58 66.86 67.13 67.4 67.79 67.93 68.2 68.48 68.76 68.89 69.16 69.42 69.56 69.83 70.1 70.37 70.64 70.9 71.16 71.29 71.56 71.83 72.09 72.23 72.49 72.89 73.03 73.3 73.71 73.84 74.11 74.38 74.65 74.93 75.2 75.46 75.72 75.99 76.26 76.39 76.67 77.07 77.21 77.47 77.88 78.02 78.28 78.55 78.81 79.08 79.48 79.62 79.89 80.16 80.43 80.56 80.83 81.11 81.39 81.52 81.79 82.05 82.19 82.46 82.73 83 83.26 83.52 83.78 84.05 84.32 84.58 84.72 84.98 85.39 85.52 85.8 86.07 86.35 86.62 86.88 87.15 87.43 87.7 87.97 88.22 88.49 88.76 88.9 89.17 89.43 89.83 89.96 90.23 90.64 90.77 91.04 91.3 91.56 91.83 92.1 92.38 92.65 93.05 93.19 93.46 93.74 94.02 94.15 94.42 94.82 94.96 95.23 95.5 95.76 96.02 96.28 96.54 96.81 97.2 97.34 97.6 98 98.14 98.41 98.69 98.96 99.23 99.5 99.78 100.06 100.32 100.59 100.85 101.12 101.39 101.52 101.8 102.06 102.33 102.46 102.72 103.13 103.27 103.54 103.8 104.06 104.32 104.6 104.87 105.14 105.41 105.67 105.81 106.08 106.5 106.64 106.91 107.17 107.44 107.71 107.98 108.25 108.51 108.77 109.03 109.3 109.7 109.83 110.09 110.36 110.63 110.77 111.05 111.45 111.59 111.86 112.13 112.4 112.67 112.95 113.21 113.47 113.73 114 114.14 114.41 114.68 114.95 115.08 115.34 115.75 115.88 116.16 116.42 116.68 116.95 117.35 117.49 117.76 118.16 118.29 118.56 118.84 119.11 119.25 119.52 119.92 120.06 120.33 120.6 120.86 121.13 121.39 121.65 121.93 122.19 122.45 122.59 122.85 123.25 123.39 123.66 123.94 124.21 124.48 124.75 125.01 125.29 125.56 125.82 126.08 126.35 126.62 126.76 127.03 127.29 127.56 127.69 127.96 128.23 128.37 128.64 128.9 129.16 129.43 129.84 129.97 130.24 130.51 130.77 130.91 131.18 131.46 131.73 131.87 132.14 132.4 132.54 132.81 133.08 133.35 133.61 134 134.14 134.4 134.67 134.93 135.06 135.33 135.73 135.87 136.14 136.42 136.69 136.96 137.22 137.5 137.77 138.05 138.31 138.58 138.84 139.25 139.38 139.65 139.93 140.19 140.45 140.72 140.99 141.13 141.4 141.66 141.92 142.19 142.46 142.73 143 143.4 143.53 143.8 144.08 144.36 144.49 144.75 145.03 145.16 145.44 145.71 145.97 146.24 146.51 146.76 147.03 147.3 147.57 147.7 147.97 148.36 148.51 148.78 149.05 149.32 149.59 149.86 150.13 150.41 150.68 150.94 151.2 151.47 151.88 152.02 152.29 152.55 152.83 152.96 153.22 153.5 153.63 153.9 154.17 154.43 154.69 154.96 155.23 155.5 155.9 156.03 156.3 156.58 156.99 157.13 157.39 157.66 157.8 158.08 158.34 158.61 158.87 159.27 159.39 159.66 160.06 160.2 160.47 160.73 161 161.14 161.41 161.69 161.96 162.23 162.5 162.77 163.05 163.32 163.58 163.71 163.97 164.37 164.51 164.78 165.04 165.31 165.45 165.71 166.12 166.25 166.52 166.78 167.05 167.31 167.58 167.85 168.12 168.39 168.66 168.8 169.07 169.49 169.62 169.89 170.29 170.42 170.7 170.96 171.23 171.49 171.75 172.01 172.28 172.68 172.81 173.08 173.34 173.61 173.75 174.02 174.3 174.56 174.84 175.11 175.38 175.65 175.92 176.19 176.45 176.72 176.98 177.12 177.39 177.66 177.93 178.06 178.32 178.6 178.73 179 179.27 179.53 179.8 180.07 180.33 180.47 180.74 181.14 181.28 181.54 181.83 182.1 182.24 182.5 182.77 183.04 183.31 183.58 183.84 184.1 184.37 184.63 184.9 185.3 185.43 185.7 185.97 186.24 186.38 186.66 186.93 187.2 187.47 187.73 188.01 188.28 188.54 188.81 189.07 189.34 189.61 189.74 190.01 190.28 190.55 190.68 190.95 191.36 191.49 191.76 192.04 192.29 192.57 192.84 193.11 193.37 193.77 193.91 194.18 194.45 194.73 194.86 195.12 195.4 195.53 195.8 196.07 196.34 196.6 196.87 197.13 197.4 197.66 197.93 198.07 198.33 198.6 198.86 199 199.28 199.55 199.68 199.95 200.22 200.49 200.76 201.03 201.29 201.56 201.82 202.23 202.36 202.63 203.03 203.17 203.44 203.85 203.98 204.26 204.52 204.78 205.05 205.32 205.59 205.86 206.13 206.39 206.52 206.79 207.2 207.34 207.61 207.88 208.15 208.28 208.56 208.82 209.09 209.35 209.61 209.88 210.15 210.55 210.69 210.95 211.35 211.49 211.76 212.04 212.17 212.44 212.71 212.98 213.25 213.53 213.79 214.05 214.32 214.59 214.86 214.99 215.27 215.67 215.8 216.07 216.48 216.62 216.88 217.15 217.41 217.67 217.95 218.22 218.48 218.75 219.02 219.15 219.43 219.84 219.98 220.24 220.65 220.79 221.06 221.33 221.59 221.85 222.12 222.38 222.65 223.04 223.18 223.45 223.71 223.98 224.12 224.39 224.8 224.94 225.21 225.48 225.75 226.03 226.3 226.56 226.82 227.09 227.36 227.49 227.77 228.03 228.3 228.43 228.7 228.97 229.1 229.37 229.63 229.89 230.16 230.56 230.7 230.97 231.23 231.5 231.64 231.91 232.19 232.46 232.6 232.87 233.14 233.28 233.55 233.82 234.22 234.35 234.61 234.61 234.97</Y2V> </SMP> </CUR> </BLC> </TIP> </GRP> </FAS> </PAR> </PRC_SST> </root:ROOT>"
)


type CVI3PSet struct {
	XMLName     xml.Name `xml:"ROOT"`
	MSL_MSG struct {
		SYN struct {
			DAT string `xml:"DAT"`
			TIM string `xml:"TIM"`
		} `xml:"SYN"`

		PID struct {
			Controller_sn	string `xml:"PRT"`
			Workorder_id	int64 `xml:"PI1"`
			Result_id	int64 `xml:"PI2"`
			Count	int `xml:"PRT"`
		} `xml:"PID"`

		PRS struct {
			PSet	int	`xml:"PRG"`
		} `xml:"PRS"`
	} `xml:"MSL_MSG"`
}

func GenerateRangeNum(len int, mtx sync.Mutex) int {
	defer mtx.Unlock()

	mtx.Lock()
	nano := time.Now().Nanosecond()

	t := fmt.Sprintf("%09d", nano)
	//fmt.Printf("%s\n", t)
	s := t[0:len]
	i, _ := strconv.Atoi(s)
	return i
}